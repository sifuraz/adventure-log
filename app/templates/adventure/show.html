{% extends "nested_base.html" %}
{% block title %}{{ adventure.name }}{% endblock %}
{% block main_title %}{{ adventure.name }}{% endblock %}
{% block content %}
<section class="section">
    <div class="container">
        <div class="notification is-danger is-hidden" id="error">{{ error }}</div>
        <div>
            <div class="adventure-details">
                <p class="subheading">{{ adventure.type | replace("_", " ") | capitalize }}</p>
                <h3>Featuring:</h3>
                <ul>
                    {% for player in adventure.players %}
                    {% if player.role == "dm" %}
                    <!--TODO crown icon-->
                    <li>{{ player.username }} as Dungeon Master</li>
                    {% elif player.character %}
                    <li>{{ player.username }} as {{ player.character.name }}</li>
                    {% else %}
                    <li>{{ player.username }}</li>
                    {% endif %}
                    {% endfor %}
                </ul>
                <button class="button" id="invite-player-btn">Invite Player</button>
            </div>
        </div>
    </div>
</section>

<!-- Modal -->
<div class="modal" id="invite-player-modal">
    <div class="modal-background"></div>
    <div class="modal-card">
        <header class="modal-card-head">
            <p class="modal-card-title">Invite Player</p>
        </header>
        <section class="modal-card-body">
            <form id="invite-player-form">
                <div class="field">
                    <label class="label">Email</label>
                    <div class="control">
                        <input class="input" type="email" placeholder="Enter email" name="email" required>
                    </div>
                </div>
            </form>
        </section>
        <footer class="modal-card-foot">
            <button class="button is-success" type="submit" form="invite-player-form">Invite</button>
            <button class="button" id="cancel-modal-btn">Cancel</button>
        </footer>
    </div>
</div>

<script>
    // Get the modal element
    var modal = document.getElementById('invite-player-modal');

    // Get the button that opens the modal
    var btn = document.getElementById('invite-player-btn');

    // Get the close button
    var closeBtn = document.getElementById('close-modal-btn');

    // Get the cancel button
    var cancelBtn = document.getElementById('cancel-modal-btn');

    // When the user clicks the button, open the modal
    btn.onclick = function () {
        modal.classList.add('is-active');
    }

    // When the user clicks on the cancel button, close the modal
    cancelBtn.onclick = function () {
        modal.classList.remove('is-active');
    }

    // Get the form element
    var form = document.getElementById('invite-player-form');

    // When the user submits the form, call the invite player endpoint
    form.onsubmit = function (event) {
        event.preventDefault();
        var email = form.elements['email'].value;
        var adventureId = parseInt("{{ adventure.id }}");
        fetch('/adventure/invite', {
            method: 'POST',
            body: JSON.stringify({
                email: email,
                adventure_id: adventureId
            }),
            headers: {
                'Content-Type': 'application/json'
            }
        })
    }
</script>
{% endblock %}
